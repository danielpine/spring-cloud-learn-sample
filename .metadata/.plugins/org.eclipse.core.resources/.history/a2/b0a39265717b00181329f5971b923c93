<!-- daniel created at 2018-06-13.-->
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@include file="/context/mytags.jsp"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>交易员</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript"
	src="/deri-web/plug-in/jquery/jquery-1.8.3.js"></script>
<script type="text/javascript"
	src="/deri-web/plug-in/finanstar/js/util/util.js"></script>
<link media="screen" rel="stylesheet"
	href="/deri-web/plug-in/finanstar/css/htmlDatePicker.css" />
<script type="text/javascript"
	src="/deri-web/plug-in/finanstar/js/htmlDatePicker.js"></script>
<script type="text/javascript"
	src="plug-in/jquery-ui/js/jquery-ui-1.9.2.custom.js"></script>
<link type="text/css" href="plug-in/jquery-ui/css/start/jquery-ui.css"
	rel="stylesheet" />
<link type="text/css"
	href="plug-in/jquery-ui/css/start/jquery.ui.theme.css" rel="stylesheet" />
<link type="text/css" href="plug-in/Validform/css/style.css"
	rel="stylesheet" />

</head>
<style>
body {
	margin: 0px 10px;
	background: lightyellow;
	font-family: "Helvetica", "Arial", "微软雅黑", "宋体", sans-serif;
	font-size: 1em;
}

.title {
	font-size: 2em;
	font-family: 'microsoft yahei', sans-serif;
	color: blue;
}

table {
	text-align: center;
	border-width: 1px;
	border-style: none none solid solid;
}

td {
	text-align: center;
	border-color: black;
	border-style: solid solid none none;
	border-width: 1px;
	font-size: 0.95em;
}

table.price {
	text-align: center;
	border-color: black;
	border-style: none none solid solid;
	border-width: 1px;
}

th.price {
	text-align: center;
	border-color: black;
	border-style: solid solid none none;
	border-width: 1px;
	background: lightcyan;
	font-size: 0.95em;
}

td.price {
	text-align: center;
	border-color: black;
	border-style: solid solid none none;
	border-width: 1px;
}

.radio input {
	width: 15px;
	height: 15px;
}

.ahover {
	color: #FFFFFF;
}

button {
	background: orange;
}

/* vue.js dialog css*/
p, h4 {
	margin: 0;
}

.modal {
	width: 480px;
	background-color: #fff;
	border: 1px solid rgba(0, 0, 0, .3);
	border-radius: 6px;
	box-shadow: 0 4px 12px rgba(0, 0, 0, .5);
	z-index: 100;
	margin-left: 150px;
	margin-top: 150px;
}

.modal-header {
	color: #fff;
	background: cadetblue;
	border-radius: 6px 6px 0 0;
	padding: 15px;
	border-bottom: 1px solid #5e9fa1;
}

.modal-content div {
	padding: 15px 10px;
}

.modal-content input {
	width: 120px;
	height: 23;
}

.modal-content select {
	width: 124px;
	height: 32;
}

.modal-footer {
	padding: 15px;
	text-align: right;
	border-top: 1px solid #e5e5e5;
}

.btn {
	border: 1px solid #d1d1d1;
	border-radius: 3px;
	background-color: #f7f7f7;
	background: -webkit-gradient(linear, 0 0, 0 100%, from(#f7f7f7),
		to(#f2f2f2));
	background: -moz-gradient(linear, 0 0, 0 100%, from(#f7f7f7),
		to(#f2f2f2));
	background: -o-gradient(linear, 0 0, 0 100%, from(#f7f7f7), to(#f2f2f2));
	background: -ms-gradient(linear, 0 0, 0 100%, from(#f7f7f7), to(#f2f2f2));
	height: 28px;
	padding: 0 20px;
	cursor: pointer;
	line-height: 28px;
	display: inline-block;
	color: #666666;
	margin-right: 5px;
	outline: none;
}

.blue {
	border: 1px solid #5e9fa1;
	background-color: #5e9fa1;
	background: -webkit-gradient(linear, 0 0, 0 100%, from(#74c4c6),
		to(#5e9fa1));
	background: -moz-gradient(linear, 0 0, 0 100%, from(#74c4c6),
		to(#5e9fa1));
	background: -o-gradient(linear, 0 0, 0 100%, from(#74c4c6), to(#5e9fa1));
	background: -ms-gradient(linear, 0 0, 0 100%, from(#74c4c6), to(#5e9fa1));
	color: #FFFFFF;
}

.popContainer {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background: rgba(0, 0, 0, 0.3);
}

p {
	margin: 10px;
}

#tbody td {
	text-align: left;
	padding-right: 20px;
	padding-left: 20px;
}

.diaadd {
	border: 0;
}

.diaadd td {
	text-align: right;
	padding-right: 20px;
	border-width: 0px 0px 0px 0px;
	padding-top: 2px;
}

.diaadd select {
	width: 228px;
	height: 26px;
}

.diaadd input[type='text'] {
	width: 100%;
}

.diaadd input[type='password'] {
	width: 100%;
}

.dlog {
	display: none;
}

.dlog dl {
	width: 120px;
	text-align: right;
}
</style>
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<body>
	<div style="width: 1400px;" align="center">
		<h1 class="title">交易员列表</h1>
	</div>
	<div style="width: 1400px;" id="app">
		<br>
		<input type="button" id="btn" value="增加交易员"
			style="font-size: 100%; height: 30px; width: 120px; background: orange;">
		&nbsp;&nbsp;&nbsp;
		<input type="button" id="mod" value="修改交易员"
			style="font-size: 100%; height: 30px; width: 120px; background: orange;">
		<p>
		<table class="price" width="1400px" cellspacing="0" cellpadding="0"
			border=1>
			<tr height="35px" style="background: lightcyan; font-size: 1em;">
				<td width=50px>Num</td>
				<td width=50px>Modify</td>
				<td width=120px>Name</td>
				<td width=150px>LoginName</td>
				<td width=150px>Phone</td>
				<td width=100px>UkeyID</td>
				<td width=50px>Status</td>
				<td width=80px>TimeStamp</td>
				<td width=100px>Maker</td>
				<td width=80px>Trader</td>
				<td width=80px>Cheker</td>
				<td width=80px>Operation</td>
			</tr>
			<tr height="35px" style="background: lightcyan; font-size: 1em;">
				<td width=50px>编号</td>
				<td width=50px>更改</td>
				<td width=120px>员工姓名</td>
				<td width=150px>登录名</td>
				<td width=150px>手机</td>
				<td width=100px>U盾</td>
				<td width=50px>运营状态</td>
				<td width=80px>设置日期</td>
				<td width=100px>设置人</td>
				<td width=80px>交易员</td>
				<td width=80px>复核员</td>
				<td width=80px>操作</td>
			</tr>


			<tbody id="tbody">
				<c:forEach items="${tlist }" var="c" varStatus="s">
					<c:set value="lightyellow" var="color"></c:set>
					<c:if test="${s.count % 2 == 0 }">
						<c:set value="lightgray" var="color"></c:set>
					</c:if>
					<tr height="30px" name="${color}" id="${c.id }"
						style="background: ${color}; font-size: 1em;">
						<td width=50px>${s.count}</td>
						<td width=50px>${c.modify }</td>
						<td width=120px>${c.tsusr.realName }</td>
						<td width=150px>${fn:replace(c.tsusr.userName, code, "")}</td>
						<td width=150px>${c.tsusr.mobilePhone }</td>
						<td width=100px>${c.num}</td>
						<td width=50px>${c.status }</td>
						<td width=80px>${c.timeStamp }</td>
						<td width=100px>${c.maker }</td>
						<td width=280px>${c.trader }</td>
						<td width=280px>${c.cheker }</td>
						<td width=80px></td>
					</tr>
				</c:forEach>
			</tbody>
		</table>
	</div>
	<div class="dlog">
		<div id="updatedialog" title="修改账户" style="">
			<form action="/deri-web/adminController.do?addorupdateproduct"
				method="post" id="update">

				<p>
					员工姓名：
					<input type="text" name="realName" id="realName" />
				<p>
					登录名：
					<input type="text" name="userName" id="userName" />
				<p>
					手机：
					<input type="text" name="mobilePhone" id="mobilePhone" />
				<p>
					交易员：
					<select name="product" id="product">
						<c:forEach items="${blist }" var="b">
							<option>${b.tradeAccount }</option>
						</c:forEach>
					</select>
				<p>
					复核员：
					<select name="product" id="product">
						<c:forEach items="${blist }" var="b">
							<option>${b.tradeAccount }</option>
						</c:forEach>
					</select>
				<p>
					运营状态：
					<select name="status" id="status">
						<option>active</option>
						<option>inactive</option>
					</select>
				<p>
					<input type="hidden" name="id" id="id" />
			</form>
		</div>
		<div id="dialog" title="增加账户">
			<form action="/deri-web/customerController.do?addtrader"
				method="post" id="form">
				<table class="diaadd" frame="box">

					<p>
					<tr>
						<td width="100px" style="text-align: right; padding-right: 10px;">员工姓名</td>
						<td><input type="text" name="realName" id="realName" /></td>
						<td width="180px" style="text-align: left"><span
							class="Validform_checktip"> 员工姓名为汉字或者英文</span></td>
					</tr>
					<p>
					<tr>
						<td width="100px" style="text-align: right; padding-right: 10px;">登录名</td>
						<td><input type="text" name="userName" id="userName" /></td>
						<td width="210px" style="text-align: left"><span
							class="Validform_checktip"> 登录名为字母或数字，最多10个字符</span></td>
					</tr>
					<p>
					<tr>
						<td width="100px" style="text-align: right; padding-right: 10px;">密码</td>
						<td><input type="password" name="password" /></td>
						<td width="180px" style="text-align: left"><span
							class="Validform_checktip"> 密码至少6个字符,最多18个字符</span></td>
					</tr>
					<p>
					<tr>
						<td width="100px" style="text-align: right; padding-right: 10px;">确认密码</td>
						<td><input type="password" name="checkpassword" /></td>
						<td width="180px" style="text-align: left"><span
							class="Validform_checktip">重复密码</span></td>
					</tr>
					<p>
					<tr>
						<td width="100px" style="text-align: right; padding-right: 10px;">手机</td>
						<td><input type="text" name="mobilePhone" id="mobilePhone" /></td>
						<td><button type="button" id="send"
								style="background: #2191c0; color: white; margin-left: -20px;">发送验证码</button>
							<input type="text" id="checkCode" style="width: 85px;"
								placeholder="输入验证码" /></td>
					</tr>
					<p>
					<tr>
						<td width="100px" style="text-align: right; padding-right: 10px;">运营状态</td>
						<td><select name="status" id="status">
								<option>active</option>
								<option>inactive</option>
							</select></td>
						<td></td>
					</tr>
					<p>
					<tr>
						<td width="100px" style="text-align: right; padding-right: 10px;">UkeyID</td>
						<td><select name="num" id="num">
							</select></td>
						<td></td>
					</tr>
					<p>
					<tr>
						<td width="100px" style="text-align: right; padding-right: 10px;">交易员</td>
						<td colspan="2" style="border: 1px solid gray; margin-left: 1px;">
							<input type="hidden" name="trader" id="trader" /> <c:forEach
								items="${blist }" var="b">
								<label>${b.tradeAccount } <input type="checkbox"
										value="${b.tradeAccount }" name="checkboxtrader"
										onclick="onClickHander(this,'trader')"></label>
							</c:forEach>
						</td>
					</tr>
					<p>
					<tr>
						<td width="100px" style="text-align: right; padding-right: 10px;">复核员</td>
						<td colspan="2" style="border: 1px solid gray; margin-left: 1px;">
							<input type="hidden" name="cheker" id="cheker" /> <c:forEach
								items="${blist }" var="b">
								<label>${b.tradeAccount } <input type="checkbox"
										value="${b.tradeAccount }" name="checkboxchecker"
										onclick="onClickHander(this,'cheker')"></label>
							</c:forEach>
						</td>

					</tr>
				</table>
			</form>
		</div>
		<div id="deldialog" title="删除确认" style="">
			<p>
				确定删除[<span id="pname"></span>]吗？
			<p>
				<input type="hidden" id="thisid" />
		</div>
	</div>
</body>
<script type="text/javascript">
    // listen checkbox
    function onClickHander(obj, id) {

	var oldVal = $("#" + id).val()
	var singalVal = $(obj).val()
	if (obj.checked) {
	    if (oldVal.indexOf(singalVal) != -1) {
	    } else {
		var comma = oldVal == "" ? "" : ","
		oldVal = oldVal + comma + singalVal
		$("#" + id).val(oldVal)
	    }
	} else {
	    if (oldVal.indexOf(singalVal) != -1) {
		if (oldVal.indexOf("," + singalVal) != -1) {
		    oldVal = oldVal.replace("," + singalVal, "")
		} else {
		    oldVal = oldVal.replace(singalVal, "")
		}

		if (oldVal.indexOf(",") == 0) {
		    oldVal = oldVal.substring(1, oldVal.length)
		}
		$("#" + id).val(oldVal)
	    }
	}

    }

    function add() {
	//表单验证
	$("#form").submit()

    }

    function setulist() {

	var boo = false;

	$.ajax({
	    async : false,
	    cache : false,
	    type : 'POST',
	    url : "/deri-web/customerController.do?ulist",// 请求的action路径
	    error : function() {// 请求失败处理函数
	    },
	    success : function(data) {

		if (data.obj == "") {
		    alert("用户已满，请联系星汇银通公司增加用户数。")
		} else {
		    var uarr = data.obj.split(",")
		    var html = ""
		    for (var i = 0; i < uarr.length; i++) {
			html += "<option>" + uarr[i] + "</option>"
		    }
		    $("#num").html(html)

		    boo = true

		}
	    },
	    dataType : 'json'

	});

	return boo;
    }

    function delProduct() {
	//ajax del
	$.ajax({
	    async : false,
	    cache : false,
	    type : 'POST',
	    url : "/deri-web/customerController.do?ulist",// 请求的action路径
	    error : function() {// 请求失败处理函数

	    },
	    success : function() {
		$('#deldialog').dialog('close')
		alert("删除成功")
		location.href = "adminController.do?product";
	    }
	});

    }
    function updateproduct(p) {
	var array = p.split("~");
	$("#nameCn").val(array[0])
	$("#nameEn").val(array[1])
	$("#code").val(array[2])
	$("#status").val(array[3])
	$("#id").val(array[4])
	$('#updatedialog').dialog('open');
	return false;
    }
    function todel(id, code) {
	$("#pname").html(code)
	$("#thisid").val(id)
	$('#deldialog').dialog('open')
    }

    $(function() {
	$('#dialog').dialog({
	    autoOpen : false,//如果设置为true，则默认页面加载完毕后，就自动弹出对话框；相反则处理hidden状态。 
	    bgiframe : true, //解决ie6中遮罩层盖不住select的问题  
	    width : 680,
	    modal : true,//这个就是遮罩效果   
	    buttons : {
		"确定" : function() {
		    add();//在这里调用函数
		},
		"取消" : function() {
		    $(this).dialog("close");
		}
	    }
	});
	$('#updatedialog').dialog({
	    autoOpen : false,//如果设置为true，则默认页面加载完毕后，就自动弹出对话框；相反则处理hidden状态。 
	    bgiframe : true, //解决ie6中遮罩层盖不住select的问题  
	    width : 600,
	    modal : true,//这个就是遮罩效果   
	    buttons : {
		"确定" : function() {
		    $("#update").submit();
		},
		"取消" : function() {
		    $(this).dialog("close");
		}
	    }
	});
	$('#deldialog').dialog({
	    autoOpen : false,//如果设置为true，则默认页面加载完毕后，就自动弹出对话框；相反则处理hidden状态。 
	    bgiframe : true, //解决ie6中遮罩层盖不住select的问题  
	    width : 300,
	    modal : true,//这个就是遮罩效果   
	    buttons : {
		"确定" : function() {
		    delProduct();//在这里调用函数
		},
		"取消" : function() {
		    $(this).dialog("close");
		}
	    }
	});

	$('#btn').click(function() {
	    if (setulist())
		$('#dialog').dialog('open');
	    return false;
	});
	$('#mod').click(function() {
	    var trs = $("#tbody").find('tr')
	    var notHave = true;
	    for (var i = 0; i < trs.length; i++) {
		if (trs.eq(i).attr("class") == "trselected") {
		    notHave = false;
		    alert("选中的是:" + trs.eq(i).html())
		    break;
		}
	    }
	    if (notHave) {
		alert("请先选中一个公司！")
	    }
	    return false;
	});

	//选中高亮
	$("#tbody").find('tr').click(function() {
	    if (reCssTr($(this))) {
		var trs = $("#tbody").find('tr')
		for (var i = 0; i < trs.length; i++) {
		    reCssTr(trs.eq(i))
		}
		$(this).css("background", "green")
		$(this).css("color", "yellow")
		$(this).attr("class", "trselected")
	    }
	});

	$("#tbody").find('tr').mouseover(
		function() {
		    if ($(this).attr("class") == undefined
			    || $(this).attr("class") == "trnotselected")
			$(this).css("background", "lightgreen")
		}).mouseout(
		function() {
		    if ($(this).attr("class") == undefined
			    || $(this).attr("class") == "trnotselected")
			$(this).css("background", $(this).attr("name"))
		})

    });

    function reCssTr(ele) {
	if (ele.attr("class") == "trselected") {
	    ele.css("background", ele.attr("name"))
	    ele.css("color", "black")
	    ele.attr("class", "trnotselected")
	    return false;
	} else {
	    return true;
	}
    }
</script>