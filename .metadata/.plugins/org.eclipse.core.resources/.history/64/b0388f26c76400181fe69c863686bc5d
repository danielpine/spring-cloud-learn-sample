<!-- daniel create at 2018-05-24.-->
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE html>
<html>
<head>
<title>利率收盘</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript"
	src="/deri-web/plug-in/jquery/jquery-1.8.3.js"></script>
<link media="screen" rel="stylesheet"
	href="/deri-web/plug-in/finanstar/css/htmlDatePicker.css" />
<script type="text/javascript"
	src="/deri-web/plug-in/finanstar/js/htmlDatePicker.js"></script>
<link media="screen" rel="stylesheet"
	href="/deri-web/plug-in/finanstar/css/body.css" />
<style type="text/css">
h1 {
	margin: 0 auto;
}

.outer {
	width: 800px;
	margin-top: 20px;
	margin-left: 20px;
	border: 1 solid red;
}

.title {
	font-size: 1.5em;
	font-family: arial, 'hiragino sans gb', 'microsoft yahei', 'Simsun',
		sans-serif;
}

li {
	color: green;
	font-size: 1.5em;
}

td {
	border: solid black;
	border-width: 1px 1px 0px 0px;
	padding: 1px 0px;
}

.but {
	width: 500px;
}

button {
	width: 120px;
	height: 30px;
	background: orange;
	margin-left: 20px;
}

button:hover {
	background: green;
	color: yellow;
}

table {
	width: 630px;
	border: solid black;
	border-width: 0px 0px 1px 1px;
}
</style>
</head>

<body>

	<div style="margin-top: 30px; width: 800px;">
		<div style="margin-left: 250px;">
			<div class="title" style="font-size:1.5em;">利率收盘</div>
		</div>
		<div class="outer">
			<div align="left" class="l">
				<font style="color: blue; width: 80px; text-align: right;">
					计价日&nbsp; </font>
				<input type='text' name='ValueDate' id='ValueDate' value=''
					onClick="GetDate(this)"
					style='width: 100px; height: 25px; background: orange; text-align: center; font-size: 0.95em;' />
			</div>
		</div>
		<div class="outer">
			<div align="left" class="l">
				<font style="color: blue; width: 80px; text-align: right;">交易所&nbsp; </font>
				<select id='Book' name='Book'
					style='width: 500px; height: 27px; font-size: 0.95em;'>
					<option value='cmc'>中国外汇交易中心Cash</option>
					<option value='cm'>中国外汇交易中心Swap</option>
					<option value='ALL'>ALL</option>
				</select>
			</div>
		</div>
		<div class="outer">
			<div align="left" class="but">
				<div class="batchbottom" align="left">
					<button type="button" id="Read" style="font-size:100%;" >读取</button>
					<button type="button" id="Save" style="font-size:100%; display: none;" >保存</button>
					&nbsp;&nbsp;&nbsp;<span id="tips"></span>
				</div>
			</div>
		</div>
		<!-- <div align="center" style="height: 30px; width: 300px;">
			
		</div> -->
		<div class="outer">
			<table id="datatable" cellspacing="0">
				<tr height="35" style="background: lightcyan; text-align: center; font-size: 0.95em;">
					<td class="price" style='width: 100px;' >收盘日</td>
					<td class="price" style='width: 100px;' >期限</td>
					<td class="price" style='width: 100px;' >价格</td>
					<td class="price" style='width: 100px;' >市场</td>
					<td class="price" style='width: 100px;' >Xtick</td>
					<td class="price" style='width: 150px;' >类型</td>
				</tr>
<!-- 			
			
				<tr height="35">
					<td width="100" class="price"
						style="background: lightcyan; text-align: center; font-size: 0.9em;">Date</td>
					<td width="100" class="price"
						style="background: lightcyan; text-align: center; font-size: 0.9em;">期限
					</td>
					<td width="100" class="price"
						style="background: lightcyan; text-align: center; font-size: 0.9em;">计价</td>
					<td width="100" class="price"
						style="background: lightcyan; text-align: center; font-size: 0.9em;">市场</td>
					<td width="100" class="price"
						style="background: lightcyan; text-align: center; font-size: 0.9em;">Xtick</td>
					<td width="130" class="price"
						style="background: lightcyan; text-align: center; font-size: 0.9em;">类型</td>
				</tr> -->
				<tbody id="tbody"></tbody>
			</table>
		</div>
	</div>
	<div id="view"></div>
	<ul id="info" style="margin-top: 20px; margin-left: 40px;"></ul>
</body>
<script type="text/javascript">
    childwindow = []
    var data;
    $(function() {

	$("#ValueDate").val(getTime())

	$("#batA").show()

	$("#Read")
		.click(
			function() {
			    console.log($(this).html() + ":"
				    + $("#ValueDate").val().replace(/\-/g, "")
				    + ":" + $("#Book").val());
			    var info = $(this).html() + ":"
				    + $("#ValueDate").val().replace(/\-/g, "")
				    + ":" + $("#Book").val();

			    $
				    .ajax({
					type : "POST", // 提交的方法
					url : "/deri-web/dataController.do?doDataCrawlerRate", // 提交的地址
					data : "&info=" + info,
					async : false,
					error : function(request) { // 失败的话
					},
					success : function(j) {// 成功

					    if (j.msg == '1'
						    || j.msg.split("@")[0] == "allerrs") {

						$("#tbody").empty();

						var a = j.obj;
						var arr;
						data = a;
						if (a.length != 0) {

						    $("#tips")
							    .html(
								    "<font color='green'>"
									    + a.length
									    + " Lines Found.</font>")
						    /*  setTimeout(
						        "$(\"#tips\").html('')",
						        3500); */

						    $("#Save").show();

						}

						for ( var i in a) {
						    arr = a[i].split("~");
						    var color;
						    if (arr[0] == "1") {
							color = "lightyellow";
						    } else {
							color = "lightgray";
						    }
						    html = "<tr height='30'>";
						    for (var ii = 1; ii < arr.length; ii++) {
							html += "<td width='100'style='background: "+color+"; text-align: center; font-size: 0.95em;'>"
								+ arr[ii]
								+ "</td>"
						    }
						    html += "</tr>";
						    $("#tbody").append(html)
						}

						if (j.msg.split("@")[0] == "allerrs") {

						    $("#tips").html('')

						    var errArr = j.msg
							    .split("@")[1]
							    .split("~");
						    for ( var err in errArr) {
							html = "<tr height='30'>";
							html += "<td width='100' colspan='6' style='color:red;text-align: center; font-size: 0.95em;'>"
								+ errArr[err]
								+ "</td>"
							html += "</tr>";
							$("#tbody")
								.append(html)
						    }

						}

					    } else {

						$("#tips").html('')

						$("#Save").hide()

						$("#tbody").empty();
						html = "<tr height='30'>";
						html += "<td width='100' colspan='6' style='text-align: center; font-size: 0.95em;'>"
							+ j.msg + "</td>"
						html += "</tr>";
						$("#tbody").append(html)
					    }

					},
					dataType : "json"
				    });

			});

	$("#Save").click(
		function() {

		    console.log(data.toString())

		    $.ajax({
			type : "POST", // 提交的方法
			url : "/deri-web/dataController.do?doDataCrawlerSave&type=CNYFR", // 提交的地址
			data : "&data=" + data.toString(),
			async : false,
			error : function(request) { // 失败的话
			},
			success : function(j) {// 成功
			    $("#tips").html(
				    "<font color='green'>" + j.obj
					    + " Lines Saved.</font>")
			    // setTimeout("$(\"#tips\").html('')", 3500);
			},
			dataType : "json"
		    });
		});

	$("#Save").mousedown(function() {
	    $("#tips").html("<font color='green'>Saving</font>")
	});
	$("#Read").mousedown(function() {
	    $("#tips").html("<font color='green'>Reading</font>")
	});

    });

    function getTime() {
	var date = new Date();
	var seperator1 = "-";
	var year = date.getFullYear();
	var month = date.getMonth() + 1;
	var strDate = date.getDate();
	if (month >= 1 && month <= 9) {
	    month = "0" + month;
	}
	if (strDate >= 0 && strDate <= 9) {
	    strDate = "0" + strDate;
	}
	var currentdate = year + seperator1 + month + seperator1 + strDate;
	return currentdate;
    }
</script>